<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choir Management System</title>
    <script src="https://unpkg.com/dexie@3.2.1/dist/dexie.js"></script>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #6e9887;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --danger: #dc3545;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 5px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #eee;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: white;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background-color: #3a5a80;
        }
        
        button.danger {
            background-color: var(--danger);
        }
        
        button.danger:hover {
            background-color: #bd2130;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .section-title {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
                border-radius: 5px;
            }
            
            .tab.active {
                border-radius: 5px 5px 0 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Choir Management System</h1>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="members">Members</div>
            <div class="tab" data-tab="rehearsals">Rehearsals</div>
            <div class="tab" data-tab="performances">Performances</div>
            <div class="tab" data-tab="attendance">Attendance</div>
        </div>
        
        <div id="members-tab" class="tab-content active">
            <h2 class="section-title">Choir Members</h2>
            <form id="member-form">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="voicePart">Voice Part</label>
                    <select id="voicePart" required>
                        <option value="">Select Voice Part</option>
                        <option value="Soprano">Soprano</option>
                        <option value="Alto">Alto</option>
                        <option value="Tenor">Tenor</option>
                        <option value="Bass">Bass</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email">
                </div>
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" id="phone">
                </div>
                <button type="submit">Add Member</button>
            </form>
            
            <div id="member-alert" class="alert" style="display: none;"></div>
            
            <h3 class="section-title">Member List</h3>
            <table id="members-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Voice Part</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="members-list">
                    <!-- Members will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div id="rehearsals-tab" class="tab-content">
            <h2 class="section-title">Rehearsals</h2>
            <form id="rehearsal-form">
                <div class="form-group">
                    <label for="rehearsal-date">Date</label>
                    <input type="date" id="rehearsal-date" required>
                </div>
                <div class="form-group">
                    <label for="rehearsal-time">Time</label>
                    <input type="time" id="rehearsal-time" required>
                </div>
                <div class="form-group">
                    <label for="rehearsal-location">Location</label>
                    <input type="text" id="rehearsal-location" required>
                </div>
                <div class="form-group">
                    <label for="rehearsal-notes">Notes</label>
                    <input type="text" id="rehearsal-notes">
                </div>
                <button type="submit">Add Rehearsal</button>
            </form>
            
            <div id="rehearsal-alert" class="alert" style="display: none;"></div>
            
            <h3 class="section-title">Upcoming Rehearsals</h3>
            <table id="rehearsals-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Location</th>
                        <th>Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="rehearsals-list">
                    <!-- Rehearsals will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div id="performances-tab" class="tab-content">
            <h2 class="section-title">Performances</h2>
            <form id="performance-form">
                <div class="form-group">
                    <label for="performance-date">Date</label>
                    <input type="date" id="performance-date" required>
                </div>
                <div class="form-group">
                    <label for="performance-time">Time</label>
                    <input type="time" id="performance-time" required>
                </div>
                <div class="form-group">
                    <label for="performance-location">Location</label>
                    <input type="text" id="performance-location" required>
                </div>
                <div class="form-group">
                    <label for="performance-description">Description</label>
                    <input type="text" id="performance-description" required>
                </div>
                <div class="form-group">
                    <label for="performance-attire">Attire</label>
                    <input type="text" id="performance-attire">
                </div>
                <button type="submit">Add Performance</button>
            </form>
            
            <div id="performance-alert" class="alert" style="display: none;"></div>
            
            <h3 class="section-title">Upcoming Performances</h3>
            <table id="performances-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Location</th>
                        <th>Description</th>
                        <th>Attire</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="performances-list">
                    <!-- Performances will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div id="attendance-tab" class="tab-content">
            <h2 class="section-title">Attendance</h2>
            <div class="form-group">
                <label for="attendance-event">Select Event</label>
                <select id="attendance-event">
                    <option value="">Select Event</option>
                    <!-- Events will be populated here -->
                </select>
            </div>
            
            <div id="attendance-section" style="display: none;">
                <h3 class="section-title">Mark Attendance</h3>
                <div id="attendance-list">
                    <!-- Attendance checkboxes will be populated here -->
                </div>
                <button id="save-attendance">Save Attendance</button>
            </div>
            
            <div id="attendance-alert" class="alert" style="display: none;"></div>
            
            <h3 class="section-title">Attendance Records</h3>
            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Present</th>
                        <th>Absent</th>
                    </tr>
                </thead>
                <tbody id="attendance-records">
                    <!-- Attendance records will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Initialize the database
        const db = new Dexie("ChoirManagementDB");
        
        // Define database schema
        db.version(1).stores({
            members: '++id, name, voicePart, email, phone',
            rehearsals: '++id, date, time, location, notes',
            performances: '++id, date, time, location, description, attire',
            attendance: '++id, eventId, eventType, date, membersPresent'
        });
        
        // Open database
        db.open().catch(function(err) {
            console.error("Failed to open db: " + (err.stack || err));
        });
        
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });
        
        // Member form submission
        document.getElementById('member-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const member = {
                name: document.getElementById('name').value,
                voicePart: document.getElementById('voicePart').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value
            };
            
            try {
                await db.members.add(member);
                showAlert('member-alert', 'Member added successfully!', 'success');
                document.getElementById('member-form').reset();
                loadMembers();
            } catch (error) {
                showAlert('member-alert', 'Error adding member: ' + error, 'danger');
            }
        });
        
        // Rehearsal form submission
        document.getElementById('rehearsal-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const rehearsal = {
                date: document.getElementById('rehearsal-date').value,
                time: document.getElementById('rehearsal-time').value,
                location: document.getElementById('rehearsal-location').value,
                notes: document.getElementById('rehearsal-notes').value
            };
            
            try {
                await db.rehearsals.add(rehearsal);
                showAlert('rehearsal-alert', 'Rehearsal added successfully!', 'success');
                document.getElementById('rehearsal-form').reset();
                loadRehearsals();
            } catch (error) {
                showAlert('rehearsal-alert', 'Error adding rehearsal: ' + error, 'danger');
            }
        });
        
        // Performance form submission
        document.getElementById('performance-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const performance = {
                date: document.getElementById('performance-date').value,
                time: document.getElementById('performance-time').value,
                location: document.getElementById('performance-location').value,
                description: document.getElementById('performance-description').value,
                attire: document.getElementById('performance-attire').value
            };
            
            try {
                await db.performances.add(performance);
                showAlert('performance-alert', 'Performance added successfully!', 'success');
                document.getElementById('performance-form').reset();
                loadPerformances();
            } catch (error) {
                showAlert('performance-alert', 'Error adding performance: ' + error, 'danger');
            }
        });
        
        // Load members into table
        async function loadMembers() {
            try {
                const members = await db.members.toArray();
                const membersList = document.getElementById('members-list');
                membersList.innerHTML = '';
                
                members.forEach(member => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.name}</td>
                        <td>${member.voicePart}</td>
                        <td>${member.email}</td>
                        <td>${member.phone}</td>
                        <td class="actions">
                            <button class="danger" onclick="deleteMember(${member.id})">Delete</button>
                        </td>
                    `;
                    membersList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading members:', error);
            }
        }
        
        // Load rehearsals into table
        async function loadRehearsals() {
            try {
                const rehearsals = await db.rehearsals.toArray();
                const rehearsalsList = document.getElementById('rehearsals-list');
                rehearsalsList.innerHTML = '';
                
                rehearsals.forEach(rehearsal => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${rehearsal.date}</td>
                        <td>${rehearsal.time}</td>
                        <td>${rehearsal.location}</td>
                        <td>${rehearsal.notes}</td>
                        <td class="actions">
                            <button class="danger" onclick="deleteRehearsal(${rehearsal.id})">Delete</button>
                        </td>
                    `;
                    rehearsalsList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading rehearsals:', error);
            }
        }
        
        // Load performances into table
        async function loadPerformances() {
            try {
                const performances = await db.performances.toArray();
                const performancesList = document.getElementById('performances-list');
                performancesList.innerHTML = '';
                
                performances.forEach(performance => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${performance.date}</td>
                        <td>${performance.time}</td>
                        <td>${performance.location}</td>
                        <td>${performance.description}</td>
                        <td>${performance.attire}</td>
                        <td class="actions">
                            <button class="danger" onclick="deletePerformance(${performance.id})">Delete</button>
                        </td>
                    `;
                    performancesList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading performances:', error);
            }
        }
        
        // Delete a member
        async function deleteMember(id) {
            if (confirm('Are you sure you want to delete this member?')) {
                try {
                    await db.members.delete(id);
                    showAlert('member-alert', 'Member deleted successfully!', 'success');
                    loadMembers();
                } catch (error) {
                    showAlert('member-alert', 'Error deleting member: ' + error, 'danger');
                }
            }
        }
        
        // Delete a rehearsal
        async function deleteRehearsal(id) {
            if (confirm('Are you sure you want to delete this rehearsal?')) {
                try {
                    await db.rehearsals.delete(id);
                    showAlert('rehearsal-alert', 'Rehearsal deleted successfully!', 'success');
                    loadRehearsals();
                } catch (error) {
                    showAlert('rehearsal-alert', 'Error deleting rehearsal: ' + error, 'danger');
                }
            }
        }
        
        // Delete a performance
        async function deletePerformance(id) {
            if (confirm('Are you sure you want to delete this performance?')) {
                try {
                    await db.performances.delete(id);
                    showAlert('performance-alert', 'Performance deleted successfully!', 'success');
                    loadPerformances();
                } catch (error) {
                    showAlert('performance-alert', 'Error deleting performance: ' + error, 'danger');
                }
            }
        }
        
        // Show alert message
        function showAlert(elementId, message, type) {
            const alertElement = document.getElementById(elementId);
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'block';
            
            // Hide alert after 3 seconds
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 3000);
        }
        
        // Initialize the application
        window.onload = function() {
            loadMembers();
            loadRehearsals();
            loadPerformances();
        };
    </script>
</body>
</html>
